---
import Layout from '../../layouts/Layout.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import { useTranslations } from '../../i18n/translations';
import { getCollection } from 'astro:content';

const lang = 'es';
const t = useTranslations(lang);

// Get articles for this locale, excluding drafts in production
const articles = await getCollection('articles', ({ slug, data }) => {
  return slug.startsWith('es/') && (import.meta.env.DEV || !data.draft);
});

// Sort by date, newest first
const sortedArticles = articles.sort((a, b) =>
  b.data.publishedDate.valueOf() - a.data.publishedDate.valueOf()
);
---

<Layout title="Escritos" lang={lang}>
  <section class="section">
    <div class="container">
      <header class="page-header">
        <h1 class="page-title">{t('section.writing')}</h1>
        <p class="page-description">{t('section.writing.description')}</p>
      </header>

      {sortedArticles.length > 0 && (
        <div class="articles-section">
          <h2 class="section-title">{t('article.localArticles')}</h2>
          <div class="articles-grid">
            {sortedArticles.map(article => (
              <ArticleCard
                title={article.data.title}
                description={article.data.description}
                publishedDate={article.data.publishedDate}
                slug={article.slug.replace('es/', '')}
                tags={article.data.tags}
                lang={lang}
                originalPlatform={article.data.originalPlatform}
              />
            ))}
          </div>
        </div>
      )}

      <div class="platforms-section">
        <h2 class="section-title">{t('article.externalPlatforms')}</h2>
        <div class="writing-platforms">
          <div class="platform-section">
            <h3 class="platform-title">
              <span class="platform-icon">‚úçÔ∏è</span>
              Medium
            </h3>
            <p class="platform-description">
              Art√≠culos en profundidad sobre desarrollo de software, arquitectura y tecnolog√≠a.
            </p>
            <a href="https://medium.com/@ismaelmartinez" class="btn btn-primary" target="_blank" rel="noopener noreferrer">
              {t('common.viewOnMedium')} ‚Üí
            </a>
          </div>

          <div class="platform-section">
            <h3 class="platform-title">
              <span class="platform-icon">üë©‚Äçüíª</span>
              Dev.to
            </h3>
            <p class="platform-description">
              Tutoriales t√©cnicos, consejos y discusiones de la comunidad.
            </p>
            <a href="https://dev.to/ismaelmartinez" class="btn btn-primary" target="_blank" rel="noopener noreferrer">
              {t('common.viewOnDevto')} ‚Üí
            </a>
          </div>
        </div>
      </div>

      <div class="writing-note">
        <p>
          Escribo sobre ingenier√≠a de software, c√≥digo abierto y la industria tecnol√≥gica.
          Visita mis perfiles en Medium y Dev.to para leer mis √∫ltimos art√≠culos.
        </p>
      </div>
    </div>
  </section>
</Layout>

<style>
  .page-header {
    margin-bottom: var(--space-2xl);
  }

  .page-title {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: var(--space-md);
  }

  .page-description {
    font-size: 1.125rem;
    color: var(--color-text-muted);
    max-width: 600px;
  }

  .section-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: var(--space-lg);
  }

  .articles-section {
    margin-bottom: var(--space-2xl);
  }

  .articles-grid {
    display: grid;
    gap: var(--space-lg);
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    margin-bottom: var(--space-xl);
  }

  .platforms-section {
    margin-bottom: var(--space-2xl);
  }

  .writing-platforms {
    display: grid;
    gap: var(--space-xl);
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }

  .platform-section {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    padding: var(--space-xl);
  }

  .platform-title {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: 1.25rem;
    margin-bottom: var(--space-md);
  }

  .platform-icon {
    font-size: 1.25rem;
  }

  .platform-description {
    color: var(--color-text-muted);
    margin-bottom: var(--space-lg);
  }

  .writing-note {
    background: var(--color-bg-secondary);
    border-left: 4px solid var(--color-accent);
    padding: var(--space-lg);
    border-radius: 0 0.5rem 0.5rem 0;
  }

  .writing-note p {
    color: var(--color-text-muted);
    margin: 0;
  }
</style>
