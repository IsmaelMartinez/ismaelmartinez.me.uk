---
import { getCollection } from 'astro:content';
import ArticleLayout from '../../../layouts/ArticleLayout.astro';
import { getReadingTime } from '../../../utils/reading-time';
import { locales } from '../../../i18n/translations';
import type { Locale } from '../../../i18n/translations';

export async function getStaticPaths() {
  const articles = await getCollection('articles');

  return locales.flatMap(lang =>
    articles
      .filter(article => article.slug.startsWith(`${lang}/`))
      .map(article => ({
        params: { lang, slug: article.slug.replace(`${lang}/`, '') },
        props: { article },
      }))
  );
}

const lang = Astro.params.lang as Locale;
const { article } = Astro.props;
const { Content } = await article.render();
const readingTime = getReadingTime(article.body || '');
---

<ArticleLayout
  title={article.data.title}
  description={article.data.description}
  publishedDate={article.data.publishedDate}
  updatedDate={article.data.updatedDate}
  originalUrl={article.data.originalUrl}
  originalPlatform={article.data.originalPlatform}
  tags={article.data.tags}
  lang={lang}
  slug={article.slug}
  readingTime={readingTime}
>
  <Content />
</ArticleLayout>
