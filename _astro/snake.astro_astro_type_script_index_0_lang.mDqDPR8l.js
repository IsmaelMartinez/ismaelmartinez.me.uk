const m=document.getElementById("game-canvas"),a=m.getContext("2d"),D=document.getElementById("game-overlay"),b=document.getElementById("game-over-overlay"),L=document.getElementById("start-btn"),R=document.getElementById("restart-btn"),w=document.getElementById("score"),k=document.getElementById("high-score"),T=document.getElementById("final-score"),t=20,l=400;m.width=l;m.height=l;let d=[],f={x:0,y:0},o={x:1,y:0},c={x:1,y:0},h=0,x=parseInt(localStorage.getItem("snake-high-score")||"0"),s=null,u=150;k.textContent=x.toString();function P(){d=[{x:10,y:10},{x:9,y:10},{x:8,y:10}],o={x:1,y:0},c={x:1,y:0},h=0,u=150,w.textContent="0",M()}function M(){do f={x:Math.floor(Math.random()*(l/t)),y:Math.floor(Math.random()*(l/t))};while(d.some(e=>e.x===f.x&&e.y===f.y))}function g(){a.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--color-bg-secondary").trim()||"#1a1a1a",a.fillRect(0,0,l,l),a.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue("--color-border").trim()||"#262626",a.lineWidth=.5;for(let e=0;e<=l;e+=t)a.beginPath(),a.moveTo(e,0),a.lineTo(e,l),a.stroke(),a.beginPath(),a.moveTo(0,e),a.lineTo(l,e),a.stroke();a.fillStyle="#ef4444",a.beginPath(),a.arc(f.x*t+t/2,f.y*t+t/2,t/2-2,0,Math.PI*2),a.fill(),d.forEach((e,r)=>{const y=a.createRadialGradient(e.x*t+t/2,e.y*t+t/2,0,e.x*t+t/2,e.y*t+t/2,t/2);if(r===0?(y.addColorStop(0,"#4ade80"),y.addColorStop(1,"#22c55e")):(y.addColorStop(0,"#22c55e"),y.addColorStop(1,"#16a34a")),a.fillStyle=y,a.beginPath(),a.roundRect(e.x*t+1,e.y*t+1,t-2,t-2,4),a.fill(),r===0){a.fillStyle="#000";const i=3,n=5;o.x===1?(a.beginPath(),a.arc(e.x*t+t-n,e.y*t+n,i,0,Math.PI*2),a.arc(e.x*t+t-n,e.y*t+t-n,i,0,Math.PI*2),a.fill()):o.x===-1?(a.beginPath(),a.arc(e.x*t+n,e.y*t+n,i,0,Math.PI*2),a.arc(e.x*t+n,e.y*t+t-n,i,0,Math.PI*2),a.fill()):o.y===-1?(a.beginPath(),a.arc(e.x*t+n,e.y*t+n,i,0,Math.PI*2),a.arc(e.x*t+t-n,e.y*t+n,i,0,Math.PI*2),a.fill()):(a.beginPath(),a.arc(e.x*t+n,e.y*t+t-n,i,0,Math.PI*2),a.arc(e.x*t+t-n,e.y*t+t-n,i,0,Math.PI*2),a.fill())}})}function p(){o=c;const e={x:d[0].x+o.x,y:d[0].y+o.y};if(e.x<0||e.x>=l/t||e.y<0||e.y>=l/t){E();return}if(d.some(r=>r.x===e.x&&r.y===e.y)){E();return}d.unshift(e),e.x===f.x&&e.y===f.y?(h+=10,w.textContent=h.toString(),M(),u>50&&(u-=2)):d.pop()}function E(){s&&(clearInterval(s),s=null),h>x&&(x=h,localStorage.setItem("snake-high-score",x.toString()),k.textContent=x.toString()),T.textContent=h.toString(),b.style.display="flex"}function A(){D.style.display="none",b.style.display="none",P(),g(),s=setInterval(()=>{p(),g()},u);const e=setInterval(()=>{if(!s){clearInterval(e);return}clearInterval(s),s=setInterval(()=>{p(),g()},u)},1e3)}const G=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","w","W","a","A","s","S","d","D"]);document.addEventListener("keydown",e=>{if(G.has(e.key)&&e.preventDefault(),!!s)switch(e.key){case"ArrowUp":case"w":case"W":o.y!==1&&(c={x:0,y:-1});break;case"ArrowDown":case"s":case"S":o.y!==-1&&(c={x:0,y:1});break;case"ArrowLeft":case"a":case"A":o.x!==1&&(c={x:-1,y:0});break;case"ArrowRight":case"d":case"D":o.x!==-1&&(c={x:1,y:0});break}});document.querySelectorAll(".control-btn").forEach(e=>{e.addEventListener("click",r=>{if(!s)return;switch(r.target.dataset.dir){case"up":o.y!==1&&(c={x:0,y:-1});break;case"down":o.y!==-1&&(c={x:0,y:1});break;case"left":o.x!==1&&(c={x:-1,y:0});break;case"right":o.x!==-1&&(c={x:1,y:0});break}})});let C=0,B=0;const I=document.querySelector(".game-area");I.addEventListener("touchstart",e=>{const r=e;r.target.closest(".game-overlay")||(r.preventDefault(),C=r.touches[0].clientX,B=r.touches[0].clientY)},{passive:!1});I.addEventListener("touchmove",e=>{e.target.closest(".game-overlay")||e.preventDefault()},{passive:!1});I.addEventListener("touchend",e=>{const r=e;if(r.target.closest(".game-overlay")||(r.preventDefault(),!s))return;const i=r.changedTouches[0].clientX,n=r.changedTouches[0].clientY,v=i-C,S=n-B;Math.abs(v)>Math.abs(S)?v>0&&o.x!==-1?c={x:1,y:0}:v<0&&o.x!==1&&(c={x:-1,y:0}):S>0&&o.y!==-1?c={x:0,y:1}:S<0&&o.y!==1&&(c={x:0,y:-1})});L.addEventListener("click",A);R.addEventListener("click",A);P();g();
