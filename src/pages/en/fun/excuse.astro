---
import Layout from '../../../layouts/Layout.astro';
import { useTranslations, getLocalizedPath } from '../../../i18n/translations';
import { devExcuses } from '../../../data/fun';

const lang = 'en';
const t = useTranslations(lang);
const excuses = devExcuses[lang];
---

<Layout title="Dev Excuse Generator" lang={lang}>
  <section class="excuse-section">
    <div class="container">
      <a href={getLocalizedPath('/fun', lang)} class="back-link">‚Üê {t('fun.backToFun')}</a>

      <div class="excuse-container">
        <div class="excuse-header">
          <span class="excuse-icon">ü§∑</span>
          <h1>{t('fun.excuse.title')}</h1>
          <p class="excuse-subtitle">{t('fun.excuse.description')}</p>
        </div>

        <div class="excuse-card">
          <div class="excuse-text-wrapper">
            <span class="quote-mark">"</span>
            <p id="excuse-text" class="excuse-text">Click the button to get your excuse!</p>
            <span class="quote-mark closing">"</span>
          </div>

          <div class="excuse-actions">
            <button id="generate-btn" class="btn btn-primary btn-large">
              <span class="btn-icon">üé≤</span> {t('fun.excuse.generate')}
            </button>
            <button id="copy-btn" class="btn btn-outline" disabled>
              <span id="copy-text">{t('fun.excuse.copy')}</span>
            </button>
          </div>
        </div>

        <div class="excuse-counter">
          <p>Excuses generated: <span id="counter">0</span></p>
        </div>

        <div class="excuse-tips">
          <h3>Pro Tips for Maximum Effect:</h3>
          <ul>
            <li>Say it with confidence</li>
            <li>Maintain eye contact</li>
            <li>Nod slowly while saying it</li>
            <li>Add "I'll look into it" at the end</li>
            <li>Follow up with "Have you tried restarting?"</li>
          </ul>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script define:vars={{ excuses, copiedText: t('fun.excuse.copied'), copyText: t('fun.excuse.copy') }}>
  const excuseText = document.getElementById('excuse-text')!;
  const generateBtn = document.getElementById('generate-btn')!;
  const copyBtn = document.getElementById('copy-btn')!;
  const copyTextEl = document.getElementById('copy-text')!;
  const counterEl = document.getElementById('counter')!;

  let counter = parseInt(localStorage.getItem('excuse-counter') || '0');
  counterEl.textContent = counter.toString();

  let currentExcuse = '';

  function generateExcuse() {
    const card = document.querySelector('.excuse-card')!;
    card.classList.add('generating');

    // Shuffle animation
    let shuffleCount = 0;
    const shuffleInterval = setInterval(() => {
      const randomExcuse = excuses[Math.floor(Math.random() * excuses.length)];
      excuseText.textContent = randomExcuse;
      shuffleCount++;

      if (shuffleCount >= 10) {
        clearInterval(shuffleInterval);
        currentExcuse = excuses[Math.floor(Math.random() * excuses.length)];
        excuseText.textContent = currentExcuse;
        card.classList.remove('generating');
        copyBtn.disabled = false;

        counter++;
        localStorage.setItem('excuse-counter', counter.toString());
        counterEl.textContent = counter.toString();
      }
    }, 50);
  }

  async function copyExcuse() {
    if (!currentExcuse) return;

    try {
      await navigator.clipboard.writeText(currentExcuse);
      copyTextEl.textContent = copiedText;
      copyBtn.classList.add('copied');

      setTimeout(() => {
        copyTextEl.textContent = copyText;
        copyBtn.classList.remove('copied');
      }, 2000);
    } catch (err) {
      console.error('Failed to copy:', err);
    }
  }

  generateBtn.addEventListener('click', generateExcuse);
  copyBtn.addEventListener('click', copyExcuse);

  // Generate one on load
  generateExcuse();
</script>

<style>
  .excuse-section {
    min-height: calc(100vh - var(--nav-height) - 200px);
    padding: var(--space-2xl) 0;
  }

  .back-link {
    display: inline-block;
    margin-bottom: var(--space-xl);
    color: var(--color-text-muted);
    transition: color 0.2s ease;
  }

  .back-link:hover {
    color: var(--color-accent);
  }

  .excuse-container {
    max-width: 600px;
    margin: 0 auto;
  }

  .excuse-header {
    text-align: center;
    margin-bottom: var(--space-2xl);
  }

  .excuse-icon {
    font-size: 5rem;
    display: block;
    margin-bottom: var(--space-lg);
    animation: shrug 2s ease-in-out infinite;
  }

  @keyframes shrug {
    0%, 100% { transform: translateY(0); }
    25% { transform: translateY(-10px) rotate(-5deg); }
    75% { transform: translateY(-10px) rotate(5deg); }
  }

  .excuse-header h1 {
    font-size: 2.5rem;
    margin-bottom: var(--space-sm);
  }

  .excuse-subtitle {
    color: var(--color-text-muted);
    font-size: 1.1rem;
  }

  .excuse-card {
    background: var(--color-bg-secondary);
    border: 2px solid var(--color-border);
    border-radius: 1rem;
    padding: var(--space-2xl);
    text-align: center;
    transition: all 0.3s ease;
  }

  .excuse-card.generating {
    border-color: #f59e0b;
    box-shadow: 0 0 30px rgba(245, 158, 11, 0.2);
  }

  .excuse-text-wrapper {
    position: relative;
    margin-bottom: var(--space-xl);
    min-height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quote-mark {
    font-size: 4rem;
    color: #f59e0b;
    opacity: 0.5;
    font-family: Georgia, serif;
    line-height: 1;
    position: absolute;
    top: -10px;
    left: 0;
  }

  .quote-mark.closing {
    left: auto;
    right: 0;
    bottom: -30px;
    top: auto;
  }

  .excuse-text {
    font-size: 1.5rem;
    font-weight: 500;
    line-height: 1.5;
    padding: 0 var(--space-2xl);
    transition: opacity 0.1s ease;
  }

  .excuse-card.generating .excuse-text {
    opacity: 0.7;
  }

  .excuse-actions {
    display: flex;
    gap: var(--space-md);
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn-large {
    padding: var(--space-md) var(--space-xl);
    font-size: 1.1rem;
  }

  .btn-icon {
    margin-right: var(--space-xs);
  }

  .btn.copied {
    border-color: #22c55e;
    color: #22c55e;
  }

  .excuse-counter {
    text-align: center;
    margin-top: var(--space-xl);
    color: var(--color-text-muted);
    font-size: 0.9rem;
  }

  .excuse-counter span {
    color: #f59e0b;
    font-weight: 700;
  }

  .excuse-tips {
    margin-top: var(--space-2xl);
    padding: var(--space-xl);
    background: var(--color-bg-secondary);
    border-radius: 1rem;
    border: 1px solid var(--color-border);
  }

  .excuse-tips h3 {
    font-size: 1.1rem;
    margin-bottom: var(--space-md);
    color: #f59e0b;
  }

  .excuse-tips ul {
    list-style: none;
  }

  .excuse-tips li {
    padding: var(--space-sm) 0;
    padding-left: var(--space-lg);
    position: relative;
    color: var(--color-text-muted);
  }

  .excuse-tips li::before {
    content: "üëâ";
    position: absolute;
    left: 0;
  }
</style>
